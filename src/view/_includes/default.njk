<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    {% if description %}<meta name="description" content="{{ description }}">{% endif %}
    <link href="/style/main.css" rel="stylesheet">
    <script async defer
      src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.2/MathJax.js?config=TeX-AMS_CHTML">
    </script>
    <script type="module" async defer src="/scripts/color-scheme.js"></script>
    <script type="text/x-mathjax-config">
      MathJax.Hub.Config({
        showMathMenu: false,
        CommonHTML: { linebreaks: { automatic: true } },
        "HTML-CSS": { linebreaks: { automatic: true } },
        SVG: { linebreaks: { automatic: true } }
      });
    </script>
    <script async defer src="https://www.googletagmanager.com/gtag/js?id=G-CQWRWZCSZW"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'G-CQWRWZCSZW');
    </script>
    <title>{{title}} - Exponential Idle Guides</title>
    <script>
      const root = document.documentElement;
      const query_root  =  document.querySelector(':root');
      const sidebar_list = ['GuideSidebar','HeaderSidebar','ResourceSidebar','sidebarmain'];
      const close_btn_list = ['GuideClose', 'HeaderClose', 'ResourceClose'];
      var curr_sidebar = 'none';
      var Mobile = false;

      function Mobile_Setup(){
        if (screen.availHeight > screen.availWidth){
          document.querySelector(':root.mobile').style.setProperty('--sidebar-column-count', '2');
        } else {
          document.querySelector(':root.mobile').style.setProperty('--sidebar-column-count', '3');
        }
        return
      }

      function Set_Device(new_class, old_class){
        root.classList.add(new_class);
        try{root.classList.remove(old_class);}catch(error){}
        
        var Mobile = (new_class == 'mobile');
        if (Mobile){Mobile_Setup();}

        window.alert("Mobile: " + String(Mobile));
      }

      if (navigator.userAgentData.mobile) {
        Set_Device("mobile","desktop");
      } else {
        Set_Device("desktop","mobile");
      }

      function openMobileSidebars(sidebars, sidebarheaders){
        curr_sidebar = sidebars[0];
        query_root.style.setProperty('--sidebar-content-padding', '8px');

        document.getElementById(sidebars[0]+"invis").style.height="auto";

        max_height = document.getElementById(sidebars[0]+"invis").offsetHeight;
        if (open_bool) {max_height+=16;}
        document.getElementById(sidebars[0]+"invis").style.height=0;

        if (max_height <= 0) {
          query_root.style.setProperty('--sidebar-height', 'auto');
          query_root.style.setProperty('--btn-marginTop', 'auto');
        } else {
          if((max_height + document.getElementById("sidebarmain").offsetHeight) >= window.visualViewport.height){
            max_height = window.visualViewport.height - document.getElementById("sidebarmain").offsetHeight;
            query_root.style.setProperty('--btn-marginTop', max_height + "px");
          } else {
            query_root.style.setProperty('--sidebar-padding-b', window.visualViewport.height * 0.01 + "px");
            query_root.style.setProperty('--btn-marginTop', (max_height + window.visualViewport.height * 0.01) + "px");
          }
          query_root.style.setProperty('--sidebar-height', max_height + "px");
          query_root.style.setProperty('--sidebar-transition-time', '0.8s');
          query_root.style.setProperty('--sidebar-text-transition-time', '0.5s');
        }
      }

      function openDesktopSidebars(sidebars, sidebarheaders){
        max_width = 0;
        mainwidth = document.getElementById("sidebarmain").offsetWidth;
        
        for (const sidebar of sidebars) {
          document.getElementById(sidebar + "invis").style.width = "auto";
          if(document.getElementById(sidebar + "invis").offsetWidth > max_width){
            max_width = document.getElementById(sidebar + "invis").offsetWidth;
          }
          document.getElementById(sidebar + "invis").style.width = 0;
        }

        document.getElementById(sidebarheaders).style.width = "auto";
        max_header_width = document.getElementById(sidebarheaders).offsetWidth;
        document.getElementById(sidebarheaders).style.width = "0%";

        if (max_width <= 0 && max_header_width <= 0) {
          query_root.style.setProperty('--sidebar-width', 'auto');
          query_root.style.setProperty('--btn-marginLeft', 'auto');
        } else {
          view_max = getComputedStyle(query_root).getPropertyValue('--sidebar-desktop-max-width');
          if (max_header_width >= window.visualViewport.width * view_max){
            output = max_header_width + window.visualViewport.width * 0.02;
          } else if (max_width >= window.visualViewport.width * view_max) {
            output = window.visualViewport.width * view_max;
          } else {
            output = max_width;
          }
          if((output + mainwidth) >= window.visualViewport.width){
            output = window.visualViewport.width * 0.96 - mainwidth;
          
          }
          query_root.style.setProperty('--sidebar-width', output + "px");
          query_root.style.setProperty('--btn-marginLeft', (output + window.visualViewport.width * 0.04) + "px");
          query_root.style.setProperty('--sidebar-padding-lr', window.visualViewport.width * 0.02 + "px");
        }
      }

      function openSidebar(sidebars, sidebarheaders, force=false) {
        for (const sidebar of sidebars) {
          document.getElementById(sidebar).style.zIndex = "0";
        }
        document.getElementById(sidebars[0]).style.zIndex = "10";
        document.getElementById('sidebarmain').style.zIndex = "11";

        if (Mobile) {
          let btn_top = getComputedStyle(query_root).getPropertyValue('--btn-marginTop');
          let sidebar_height = getComputedStyle(query_root).getPropertyValue('--sidebar-height');
          
          if ((btn_top == "0%" && sidebar_height == "0%") || curr_sidebar != sidebars[0] || force) {
            openMobileSidebars(sidebars, sidebarheaders);
          }
        } else {
          let btn_left = getComputedStyle(query_root).getPropertyValue('--btn-marginLeft');
          let sidebar_height = getComputedStyle(query_root).getPropertyValue('--sidebar-width');

          if ((btn_left == "0%" && sidebar_height == "0%") || force) {
            openDesktopSidebars(sidebars, sidebarheaders);
          }
        }
      }

      function CloseSidebar(){
        let attr_list = ['sidebar-width', 'btn-marginLeft', 'sidebar-padding-lr'];
        
        if (Mobile){
          query_root.style.setProperty('--sidebar-transition-time', '0.5s');
          query_root.style.setProperty('--sidebar-text-transition-time', '0.3s');
          let attr_list = ['sidebar-height', 'btn-marginTop', 'sidebar-padding-b'];
        }
        
        attr_list.push('sidebar-content-padding');
        for (const attr in attr_list){
          query_root.style.setProperty('--'+attr, "0%");
        }
        var curr_sidebar='none';
        return
      }

      function testSidebar(btn_list, sidebar_list){
        bool = true;
        window.alert("btn_list: " + String(btn_list) + "\nsidebar_list: " + String(sidebar_list));
        for(const btn of btn_list){
          if (document.getElementById(btn).contains(e.target)==true){
            bool=false;
            window.alert(String(bool) + ' button: ' + String(btn) + ' , ' + String(close_btn_list));
            break;
          }
        }
        window.alert("btn_list results: " + String(bool));
        if(bool) {
          bool=false
          for(const sidebars of sidebar_list){
            if (document.getElementById(sidebars).contains(e.target)==true){
              bool = true;
              window.alert(String(bool) + ' sidebar: ' + String(sidebars) + ' , ' + String(sidebar_list));
              break;
            }
          }
        }
        window.alert('Click Bool: ' + String(bool));
        return (!bool)
      }

      window.addEventListener('click', function(e){
        sidebar=0;sidebar_attr=0;sidebar_root='';
        if (Mobile){
          sidebar = document.getElementById(curr_sidebar).offsetHeight;
          sidebar_attr = Number(window.getComputedStyle(document.body).getPropertyValue('--sidebar-height').match(/\d+/)[0]);
          sidebar_root = getComputedStyle(query_root).getPropertyValue('--sidebar-height');
        } else {
          sidebar = Math.round(document.getElementById("HeaderSidebar").offsetWidth - window.visualViewport.width * 0.04);
          sidebar_attr = Number(window.getComputedStyle(document.body).getPropertyValue('--sidebar-width').match(/\d+/)[0]);
          sidebar_root = getComputedStyle(query_root).getPropertyValue('--sidebar-width');
        }
        window.alert("Close Listener: " + String(sidebar >= sidebar_attr) + " && " + String(sidebar_root != "0%"));


        if ((sidebar >= sidebar_attr) && (String(sidebar_root) != "0%")) {
          sidebar_bool = testSidebar(close_btn_list, sidebar_list);
          window.alert(sidebar_bool);
          if(sidebar_bool){CloseSidebar();}
        }
      })

      function openpopup(display_id){
        if(document.getElementById(display_id).style.display == "block"){
          document.getElementById(display_id).style.display = "none";
        } else {
          document.getElementById(display_id).style.display = "block";
        }
      }

      screen.orientation.addEventListener("change", function(e){
        mobile_setup();
        if(curr_sidebar!='none'){
          sidebar_list.sort(function(x,y){ return x == curr_sidebar ? -1 : y == curr_sidebar ? 1 : 0; });
          CloseSidebar();
          openSidebar(sidebar_list, 'SidebarHeaders', true);
        }
      });
    </script>
  </head>
  <body>
    {% block sidebar %}{% endblock %}

    <header class="page-section header" id="top">
      <button class="btn-color-scheme-toggle">
        <span class="light"><img alt="Light mode toggle" src="/images/sun.svg"></span>
        <span class="dark"><img alt="Dark mode toggle" src="/images/moon.svg"></span>
      </button>
      <h1><a href="/">Exponential Idle Guides</a></h1>
      {{ nav | safe }}
    </header>

    <main class="page-section content-wrapper">
      {% block title %}
        <h2>{{title}}</h2>
        {% if subtitle %}
          <p class="subtitle">{{ subtitle }}</p>
        {% endif %}
      {% endblock %}

      {% block main %}{% endblock %}

      {% if nav %}
        <div class="post-content-nav">
        </div>
      {% endif %}
    </main>
    
    <footer class="page-section footer">
      <div class="footer__section footer__section--main">
        {{ nav | safe }}
      </div>
      <div class="footer__section">
        <p>Any feedback?   <a href="https://docs.google.com/forms/d/e/1FAIpQLSdje1OWIgI1vqMry6U1E51bxh3VE4tLilTdRyqun1aVmP7pag/viewform">
          Submit it to us.
        </a>
        <p>Want to see the responses? <a href="https://bit.ly/ex-guide-suggestion-responses">
          Take a look.
        </a>
      </div>
      <div class="footer__section">
        <p>Guides copyright <a href="https://github.com/LEBaldy">LE★Baldy</a> & <a href="https://github.com/Snaeks">Snaeky</a>.
        <p>Website created by <a href="https://ticklethepanda.dev">TickleThePanda</a>.
      </div>
      
      <a href="#top" class="back-to-top-link" aria-label="Scroll to Top">
        <svg
          xmlns="http://www.w3.org/2000/svg"
          width="24"
          height="24"
          viewBox="0 0 24 24"
          fill="none"
          stroke="currentColor"
          stroke-width="2"
          stroke-linecap="round"
          stroke-linejoin="round"
        >
          <polyline points="18 15 12 9 6 15" />
        </svg>
      </a>
    </footer>
  </body>
</html>
